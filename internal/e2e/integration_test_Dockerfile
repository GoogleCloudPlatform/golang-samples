FROM golang:1.5

RUN curl -o /tmp/cloud_sdk.bash https://dl.google.com/dl/cloudsdk/release/install_google_cloud_sdk.bash
RUN /bin/bash /tmp/cloud_sdk.bash --install-dir /
ENV GCLOUD_BIN /google-cloud-sdk/bin/gcloud

# Install gcloud preview app
RUN /google-cloud-sdk/bin/gcloud --quiet help preview app > /dev/null

RUN go get google.golang.org/appengine/cmd/aedeploy

ADD . /go/src/appengine_demos

WORKDIR /go/src/appengine_demos
ENV GO15VENDOREXPERIMENT 1
RUN go get -t -d appengine_demos/...
CMD go test -v appengine_demos
